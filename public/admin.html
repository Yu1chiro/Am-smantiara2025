<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin</title>
    <link rel="shortcut icon"
        href="https://media.canva.com/v2/image-resize/format:PNG/height:197/quality:100/uri:ifs%3A%2F%2FM%2F488008b2-a67a-4cd4-933a-bf4fa4a57ea8/watermark:F/width:200?csig=AAAAAAAAAAAAAAAAAAAAAEvWCjXbIWjJkbmlReB9dJdPEoTPK-iDoqbM1vHCLCui&exp=1757487345&osig=AAAAAAAAAAAAAAAAAAAAAAqD9jqx-nud_6jrUDrqNws0NR3YkQlF0po2oebGHZDf&signer=media-rpc&x-canva-quality=thumbnail"
        type="image/x-icon">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>

<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-semibold text-gray-900">Dashboard Admin</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="user-info" class="flex items-center space-x-3">
                        <!-- User info akan dimuat di sini -->
                    </div>
                    <button id="logout-btn"
                        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition duration-200">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Welcome Section -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Selamat Datang Admin!</h2>
            <p class="text-gray-600">Anda berhasil login sebagai administrator sistem.</p>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z">
                                </path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Total Users</p>
                        <p id="total-users" class="text-2xl font-bold text-gray-900">-</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Admin Users</p>
                        <p id="admin-users" class="text-2xl font-bold text-gray-900">-</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">

                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Credential Akun</p>
                        <p class="text-sm text-gray-900">
                            Gunakan akun dibawah untuk login ke uploadcare
                        </p>
                        <p class="text-sm text-gray-900">
                            Email : amsmantiara2025@gmail.com
                        </p>
                        <p class="text-sm text-gray-900">
                            Pass : @amsmantiara#2025
                        </p>
                        <a href="https://app.uploadcare.com/" class="text-blue-600 text-sm">Login Uploadcare</a>
                    </div>
                </div>
            </div>

            <!-- Sub Menu -->
            <a href="/activity" class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center text-white">
                            <i class="fas fa-tasks"></i> <!-- Icon Activity -->
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-xl font-medium text-gray-600">Create Activity</p>
                    </div>
                </div>
            </a>

            <a href="/gallery" class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center text-white">
                            <i class="fas fa-image"></i> <!-- Icon Gallery -->
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-xl font-medium text-gray-600">Upload Foto</p>
                    </div>
                </div>
            </a>

            <a href="/devision" class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center text-white">
                            <i class="fas fa-users"></i> <!-- Icon Devisi -->
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-xl font-medium text-gray-600">Create Devisi</p>
                    </div>
                </div>
            </a>

        </div>

        <!-- Users Table -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Daftar Pengguna</h3>
            </div>
            <div class="overflow-x-auto">
                <div id="loading-users" class="flex items-center justify-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    <span class="ml-2 text-gray-600">Memuat data pengguna...</span>
                </div>
                <table id="users-table" class="min-w-full divide-y divide-gray-200 hidden">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                User</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Email</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Role</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Tanggal Daftar</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody" class="bg-white divide-y divide-gray-200">
                        <!-- Data users akan dimuat di sini -->
                    </tbody>
                </table>
                <div id="no-users" class="hidden text-center py-8 text-gray-500">
                    Tidak ada data pengguna
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentUser = null;

        // Cek status login saat halaman dimuat
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();

                if (!data.success || data.user.role !== 'admin') {
                    // Jika tidak login atau bukan admin, redirect ke login
                    window.location.href = '/login';
                    return;
                }

                currentUser = data.user;
                displayUserInfo();
                loadUsers();

            } catch (error) {
                console.error('Error checking login status:', error);
                window.location.href = '/login';
            }
        });

        // Tampilkan info user di header
        function displayUserInfo() {
            const userInfoDiv = document.getElementById('user-info');
            userInfoDiv.innerHTML = `
                <img src="${currentUser.profileIcon}" alt="Profile" class="w-8 h-8 rounded-full">
                <div>
                    <p class="text-sm font-medium text-gray-900">${currentUser.name}</p>
                    <p class="text-xs text-gray-500">${currentUser.role}</p>
                </div>
            `;
        }

        // Load data users
        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const data = await response.json();

                if (data.success && data.users) {
                    const users = Object.values(data.users);
                    displayUsers(users);
                    updateStats(users);
                } else {
                    showNoUsers();
                }
            } catch (error) {
                console.error('Error loading users:', error);
                showNoUsers();
            }
        }

        // Tampilkan data users di tabel
        function displayUsers(users) {
            const loadingDiv = document.getElementById('loading-users');
            const tableDiv = document.getElementById('users-table');
            const noUsersDiv = document.getElementById('no-users');
            const tbody = document.getElementById('users-tbody');

            loadingDiv.classList.add('hidden');

            if (users.length === 0) {
                noUsersDiv.classList.remove('hidden');
                return;
            }

            tableDiv.classList.remove('hidden');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <img src="${user.profileIcon}" alt="Profile" class="w-10 h-10 rounded-full mr-4">
                            <div>
                                <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                <div class="text-sm text-gray-500">ID: ${user.uid}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${user.email}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            user.role === 'admin' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                        }">
                            ${user.role}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${user.createdAt ? new Date(user.createdAt).toLocaleDateString('id-ID', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        }) : '-'}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Tampilkan pesan tidak ada users
        function showNoUsers() {
            const loadingDiv = document.getElementById('loading-users');
            const noUsersDiv = document.getElementById('no-users');

            loadingDiv.classList.add('hidden');
            noUsersDiv.classList.remove('hidden');
        }

        // Update statistik
        function updateStats(users) {
            const totalUsers = users.length;
            const adminUsers = users.filter(user => user.role === 'admin').length;

            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('admin-users').textContent = adminUsers;
        }

        // Logout handler
        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    window.location.href = '/login';
                } else {
                    alert('Terjadi kesalahan saat logout');
                }
            } catch (error) {
                console.error('Error during logout:', error);
                // Tetap redirect ke login meskipun ada error
                window.location.href = '/login';
            }
        });
    </script>
</body>

</html>